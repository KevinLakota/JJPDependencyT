package Service;

import Model.Dependency;
import Model.Vulnerability;
import Service.External.OsvClient;
import Service.Repository.DependencyRepository;
import Service.Repository.VulnerabilityRepository;

import java.util.ArrayList;
import java.util.List;

public class VulnerabilityScannerService {

    public static void scanProjectForVulnerabilities(int projectId) {
        List<Dependency> dependencies = DependencyRepository.getForProject(projectId);
        List<Vulnerability> allVulnerabilities = new ArrayList<>();

        System.out.println("\n--- Skenujem zraniteÄ¾nosti pre projekt ID " + projectId + " ---");

        for (Dependency dep : dependencies) {
            List<Vulnerability> vulns = OsvClient.fetchVulnerabilities(
                    dep.getLanguage(), dep.getName(), dep.getVersion()
            );
            allVulnerabilities.addAll(vulns);
        }

        VulnerabilityRepository.replaceForProject(projectId, allVulnerabilities);
    }
}
